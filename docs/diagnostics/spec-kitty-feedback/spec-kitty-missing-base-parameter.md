# spec-kitty Bug Report: Missing --base Parameter in Agent Workflow Implement

**Date:** 2026-01-24
**Version:** spec-kitty-cli 0.12.0
**Severity:** Medium - Feature parity gap between commands
**Reporter:** Claude Opus (via Kent Gale)
**Status:** PARTIALLY RESOLVED - Workaround available

## Summary

The `--base` parameter exists in `spec-kitty implement` but is **missing** from `spec-kitty agent workflow implement`. This creates confusion because:
1. WP prompt files reference `spec-kitty implement --base`
2. The `/spec-kitty.implement` skill instructs agents to use `spec-kitty agent workflow implement`
3. The agent command lacks the `--base` parameter

## Root Cause

There are **two different implement commands** with different capabilities:

| Command | Has `--base` | Creates Worktree | Outputs Prompt |
|---------|--------------|------------------|----------------|
| `spec-kitty implement` | ✅ YES | ✅ YES | ❌ NO |
| `spec-kitty agent workflow implement` | ❌ NO | ❌ NO | ✅ YES |

## Command Attempted

```bash
spec-kitty agent workflow implement WP04 --base WP03 --agent claude-opus
```

## Error Message

```
Usage: spec-kitty agent workflow implement [OPTIONS] [WP_ID]
Try 'spec-kitty agent workflow implement --help' for help.
╭─ Error ──────────────────────────────────────────────────────────────────────╮
│ No such option: --base Did you mean --agent?                                 │
╰──────────────────────────────────────────────────────────────────────────────╯
```

## Available Options (from --help)

```
╭─ Options ────────────────────────────────────────────────────────────────────╮
│ --feature        TEXT  Feature slug (auto-detected if omitted)               │
│ --agent          TEXT  Agent name (required for auto-move to doing lane)     │
│ --help                 Show this message and exit.                           │
╰──────────────────────────────────────────────────────────────────────────────╯
```

## Documentation vs Implementation Mismatch

The WP03 prompt file (generated by `/spec-kitty.tasks`) contains:

```markdown
**Implementation Command**:
```bash
spec-kitty implement WP03 --base WP02
```
(Note: Assumes WP01 and WP02 are both merged. Use the latest merged WP as base.)
```

This suggests the `--base` parameter should exist but was either:
1. Never implemented
2. Removed without updating the prompt templates
3. Intended for a future release

## Reproduction Steps

1. Create a feature with multiple WPs where later WPs depend on earlier ones
2. Complete WP01-WP03 in their respective branches (not yet merged to main)
3. Attempt to start WP04 with: `spec-kitty agent workflow implement WP04 --base WP03 --agent claude-opus`
4. Command fails with "No such option: --base"

## Impact

**Critical for multi-WP features:**

- Feature 064 has WP01 → WP02 → WP03 → WP04 dependency chain
- WP03 worktree contains accumulated code from WP01 + WP02 + WP03
- WP04 cannot be started via normal workflow because main branch lacks WP01-WP03 code
- Agents must manually create worktrees with git commands, breaking the spec-kitty workflow

**Workflow Break:**

Without `--base`, agents are forced to either:
1. Merge all preceding WPs to main before starting dependent WPs (defeats parallel development)
2. Manually create worktrees with git commands (breaks workflow consistency)

## Expected Behavior

```bash
spec-kitty agent workflow implement WP04 --base WP03 --agent claude-opus
```

Should:
1. Create WP04 worktree branched from the WP03 branch (not main)
2. Move WP04 to "doing" lane
3. Output the WP04 prompt with implementation instructions

## Working Solution

Use the **top-level** `spec-kitty implement` command (not the agent workflow command):

```bash
# This works! Creates worktree based on WP03
spec-kitty implement WP04 --base WP03 --feature 064-finishedgoods-snapshot-architecture
```

Output:
```
→ Base tracking: 064-finishedgoods-snapshot-architecture-WP03 @ 98fadf2
→ WP04 moved to 'doing' (committed to main)
✓ Workspace created successfully
```

## Recommended Workflow for Dependent WPs

For WPs that depend on other WPs (not yet merged to main):

```bash
# Step 1: Use top-level implement with --base to create worktree
spec-kitty implement WP04 --base WP03 --feature 064-finishedgoods-snapshot-architecture

# Step 2: Change to worktree
cd .worktrees/064-finishedgoods-snapshot-architecture-WP04

# Step 3: (Optional) Get the prompt if needed
spec-kitty agent workflow implement WP04 --agent claude-opus
```

## Suggested Fix

Add `--base` option to `spec-kitty agent workflow implement` for feature parity:

```python
@click.option('--base', type=str, default=None,
              help='Base WP to branch from (e.g., WP01). Calls top-level implement internally.')
```

When `--base` is provided:
- Internally call `spec-kitty implement WP_ID --base BASE_WP`
- Then output the prompt as normal

Alternatively, update the `/spec-kitty.implement` skill to detect dependencies and suggest the correct command.

## Related Issues

This is a **feature parity gap** between the top-level and agent commands:
- `spec-kitty-template-cli-mismatch.md` - Similar pattern of command differences
- `spec-kitty-wrong-params.md` - Other parameter discrepancies

## Environment

- OS: macOS Darwin 25.2.0
- Python: 3.13.11
- spec-kitty-cli: 0.12.0 (pip reports 0.10.13 - possible version mismatch)
- Feature: 064-finishedgoods-snapshot-architecture

## Resolution

**Workaround available:** Use `spec-kitty implement --base` instead of `spec-kitty agent workflow implement` for dependent WPs.

**Tested and verified:** WP04 worktree successfully created based on WP03 using:
```bash
spec-kitty implement WP04 --base WP03 --feature 064-finishedgoods-snapshot-architecture
```
