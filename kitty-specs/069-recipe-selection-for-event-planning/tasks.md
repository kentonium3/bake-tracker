# Work Packages: Recipe Selection for Event Planning

**Inputs**: Design documents from `/kitty-specs/069-recipe-selection-for-event-planning/`
**Prerequisites**: plan.md (required), spec.md (user stories), research.md, data-model.md

**Tests**: Service layer tests included per constitution requirement (>70% coverage).

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package must be independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/` generated by `/spec-kitty.tasks`.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Include precise file paths or modules.

---

## Work Package WP01: Service Layer Methods (Priority: P0)

**Goal**: Implement recipe selection service methods in event_service.py.
**Independent Test**: Unit tests pass for `set_event_recipes()` and `get_event_recipe_ids()`.
**Prompt**: `/tasks/WP01-service-layer-methods.md`
**Estimated Size**: ~350 lines

### Included Subtasks
- [x] T001 Implement `get_event_recipe_ids(session, event_id)` method
- [x] T002 Implement `set_event_recipes(session, event_id, recipe_ids)` method
- [x] T003 Add validation for event existence and recipe existence
- [x] T004 [P] Write unit tests for service methods

### Implementation Notes
- Follow existing event_service.py patterns (F068)
- Use delete-then-insert pattern for `set_event_recipes()` per research.md
- Accept optional `session` parameter per session management guidelines
- Return count from `set_event_recipes()`, list of IDs from `get_event_recipe_ids()`

### Parallel Opportunities
- T004 (tests) can be written in parallel once method signatures are defined

### Dependencies
- None (starting package) - uses existing EventRecipe model from F068

### Risks & Mitigations
- Session management issues → Follow CLAUDE.md session guidelines, accept session parameter

---

## Work Package WP02: Recipe Selection UI Component (Priority: P1)

**Goal**: Create `RecipeSelectionFrame` widget with scrollable checkbox list.
**Independent Test**: Frame renders with checkboxes, visual distinction visible, count updates.
**Prompt**: `/tasks/WP02-recipe-selection-ui-component.md`
**Estimated Size**: ~450 lines

### Included Subtasks
- [x] T005 Create `RecipeSelectionFrame` class with scrollable container
- [x] T006 Implement checkbox list population from recipe data
- [x] T007 Implement visual distinction for base vs variant recipes (indent + label)
- [x] T008 Implement selection count display ("X of Y recipes selected")
- [x] T009 Implement `get_selected_ids()` and `set_selected(recipe_ids)` methods
- [x] T010 Add Save and Cancel buttons with callback hooks

### Implementation Notes
- Use CTkScrollableFrame for scrollable list (per research.md)
- Store BooleanVar per recipe in dict: `self.recipe_vars: Dict[int, ctk.BooleanVar]`
- Visual distinction: indent prefix + "(variant: {variant_name})" suffix
- Count updates on every checkbox change via command callback

### Parallel Opportunities
- None - sequential UI component build

### Dependencies
- Depends on WP01 (service methods needed for integration)

### Risks & Mitigations
- Performance with 100+ recipes → Use lazy loading or virtualization if needed
- Checkbox state sync → Use BooleanVar.get()/set() consistently

---

## Work Package WP03: Planning Tab Integration (Priority: P1)

**Goal**: Embed RecipeSelectionFrame in PlanningTab with full event lifecycle integration.
**Independent Test**: Select event → see recipe selection → check recipes → save → reload → selections persist.
**Prompt**: `/tasks/WP03-planning-tab-integration.md`
**Estimated Size**: ~400 lines

### Included Subtasks
- [x] T011 Embed `RecipeSelectionFrame` in `PlanningTab` layout (Row 2)
- [x] T012 Wire event selection callback to show/hide and populate frame
- [x] T013 Implement Save button handler (call `set_event_recipes()`)
- [x] T014 Implement Cancel button handler (revert to loaded state)
- [ ] T015 Handle edge cases (no event selected, empty recipe list, save failure)
- [ ] T016 [P] Add integration tests for full workflow

### Implementation Notes
- Frame hidden when no event selected, shown when event selected
- Load existing selections on event select via `get_event_recipe_ids()`
- Save uses session_scope() pattern from PlanningTab
- Update header with event name: "Recipe Selection for {event.name}"

### Parallel Opportunities
- T016 (integration tests) can be written after implementation

### Dependencies
- Depends on WP01 (service methods)
- Depends on WP02 (UI component)

### Risks & Mitigations
- Session detachment → Use single session_scope for load and save operations
- State sync on event change → Reset frame state on each event selection

---

## Dependency & Execution Summary

- **Sequence**: WP01 → WP02 → WP03 (sequential due to service → UI → integration flow)
- **Parallelization**: Limited - WP01 tests (T004) and WP03 tests (T016) can run parallel to later tasks
- **MVP Scope**: All three work packages required for MVP

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001       | get_event_recipe_ids method | WP01 | P0 | No |
| T002       | set_event_recipes method | WP01 | P0 | No |
| T003       | Validation logic | WP01 | P0 | No |
| T004       | Service unit tests | WP01 | P0 | Yes |
| T005       | RecipeSelectionFrame class | WP02 | P1 | No |
| T006       | Checkbox list population | WP02 | P1 | No |
| T007       | Visual distinction | WP02 | P1 | No |
| T008       | Selection count display | WP02 | P1 | No |
| T009       | get_selected_ids/set_selected | WP02 | P1 | No |
| T010       | Save/Cancel buttons | WP02 | P1 | No |
| T011       | Embed in PlanningTab | WP03 | P1 | No |
| T012       | Event selection callback | WP03 | P1 | No |
| T013       | Save handler | WP03 | P1 | No |
| T014       | Cancel handler | WP03 | P1 | No |
| T015       | Edge case handling | WP03 | P1 | No |
| T016       | Integration tests | WP03 | P1 | Yes |
