# Implementation Plan: Workflow-Aligned Navigation Cleanup

**Branch**: `055-workflow-aligned-navigation-cleanup` | **Date**: 2026-01-15 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `kitty-specs/055-workflow-aligned-navigation-cleanup/spec.md`

---

## Summary

Reorganize UI navigation to match user's natural workflow: Observe → Catalog → Plan → Purchase → Make → Deliver. Restructure Catalog menu into 4 logical groups (Ingredients, Materials, Recipes, Packaging), reorder Purchase tabs to workflow order (Inventory → Purchases → Shopping Lists), remove unused tree view from Ingredients tab, and add Deliver mode placeholder.

---

## Technical Context

**Language/Version**: Python 3.10+
**Primary Dependencies**: CustomTkinter, tkinter (ttk.Treeview)
**Storage**: SQLite (no schema changes)
**Testing**: pytest - UI tests via manual verification, service layer unchanged
**Target Platform**: Desktop (Windows/macOS)
**Project Type**: Single desktop application
**Performance Goals**: No impact - UI restructuring only
**Constraints**: Maintain all existing functionality, preserve tab state
**Scale/Scope**: ~8 files modified, 3-4 new files

---

## Constitution Check

*GATE: All checks must pass before implementation.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. User-Centric Design | ✅ PASS | Navigation matches user mental model |
| II. Data Integrity | ✅ PASS | No data changes, navigation only |
| III. Future-Proof Schema | ✅ N/A | No schema changes |
| IV. Test-Driven Development | ✅ PASS | UI changes manually testable |
| V. Layered Architecture | ✅ PASS | UI layer only, no service changes |
| VI. Schema Change Strategy | ✅ N/A | No schema changes |
| VII. Pragmatic Aspiration | ✅ PASS | Simple restructuring, no over-engineering |

---

## Project Structure

### Documentation (this feature)

```
kitty-specs/055-workflow-aligned-navigation-cleanup/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Codebase analysis
├── checklists/          # Quality checklists
└── tasks/               # Work packages (generated by /spec-kitty.tasks)
```

### Source Code Changes

```
src/ui/
├── mode_manager.py              # MODIFY: MODE_ORDER, add DELIVER
├── main_window.py               # MODIFY: mode_configs, grid columns
├── modes/
│   ├── catalog_mode.py          # MODIFY: restructure to group tabs
│   ├── purchase_mode.py         # MODIFY: reorder tabs
│   └── deliver_mode.py          # NEW: placeholder mode
├── tabs/
│   ├── ingredients_group_tab.py # NEW: wrapper for Ingredients + Products
│   ├── recipes_group_tab.py     # NEW: wrapper for Recipes + Finished Units
│   └── packaging_group_tab.py   # NEW: wrapper for Finished Goods + Packages
└── ingredients_tab.py           # MODIFY: remove tree view toggle
```

**Structure Decision**: Extend existing mode/tab architecture with new group wrapper tabs

---

## Implementation Approach

### Phase 1: Mode Navigation Reorder (FR-1, FR-6)

**Goal**: Reorder modes and add Deliver placeholder

1. **Update mode_manager.py**:
   - Change MODE_ORDER to `["OBSERVE", "CATALOG", "PLAN", "PURCHASE", "MAKE", "DELIVER"]`
   - Add "DELIVER" to mode_tab_state initialization
   - Update any index-based logic for 6 modes

2. **Create deliver_mode.py**:
   - Extend BaseMode
   - Show placeholder message: "Delivery workflows coming soon"
   - Implement required abstract methods (setup_tabs, setup_dashboard)

3. **Update main_window.py**:
   - Update mode_configs to new order with Ctrl+1-6
   - Change mode_bar grid to 6 columns
   - Register DELIVER mode with mode_manager
   - Import and instantiate DeliverMode

**Testing**: Verify all 6 modes accessible, shortcuts work, Deliver shows placeholder

---

### Phase 2: Purchase Mode Tab Reorder (FR-3)

**Goal**: Reorder Purchase tabs to Inventory → Purchases → Shopping Lists

1. **Update purchase_mode.py**:
   - Reorder `tabview.add()` calls in `setup_tabs()`
   - Update `activate()` lazy loading order if needed
   - No logic changes, just ordering

**Testing**: Verify tab order, existing functionality preserved

---

### Phase 3: Catalog Menu Restructure (FR-2)

**Goal**: Restructure Catalog into 4 groups with nested sub-tabs

1. **Create group wrapper tabs** (following MaterialsTab pattern):

   **ingredients_group_tab.py**:
   - Container with CTkTabview
   - Sub-tabs: "Ingredient Catalog", "Food Products"
   - Embed existing IngredientsTab and ProductsTab widgets

   **recipes_group_tab.py**:
   - Container with CTkTabview
   - Sub-tabs: "Recipes Catalog", "Finished Units"
   - Embed existing RecipesTab and FinishedUnitsTab widgets

   **packaging_group_tab.py**:
   - Container with CTkTabview
   - Sub-tabs: "Finished Goods (Food Only)", "Finished Goods (Bundles)", "Packages"
   - Embed existing PackagesTab widget
   - Create filtered views for Finished Goods

2. **Update catalog_mode.py**:
   - Replace flat tabs with 4 group tabs:
     - "Ingredients" → IngredientsGroupTab
     - "Materials" → MaterialsTab (unchanged)
     - "Recipes" → RecipesGroupTab
     - "Packaging" → PackagingGroupTab
   - Update `activate()` and `refresh_all_tabs()` methods

3. **Handle Finished Goods filtering**:
   - Research bundle vs food-only distinction in model
   - Add filter parameter to FinishedGoodsTab or create filtered views

**Testing**: Verify all tabs accessible, navigation works, functionality preserved

---

### Phase 4: Tree View Removal (FR-5)

**Goal**: Remove Flat/Tree toggle from Ingredients tab

1. **Update ingredients_tab.py**:
   - Remove `_view_mode` variable
   - Remove view toggle CTkSegmentedButton from filter bar
   - Remove `_create_tree_view()` method
   - Remove `_on_view_change()` method
   - Remove `tree_container` and `ingredient_tree` references
   - Remove tree-related search/filter logic
   - Always show flat view (grid)

2. **Preserve IngredientTreeWidget**:
   - Keep widget file - used in recipe_form.py for ingredient selection
   - Only remove from ingredients_tab.py

**Testing**: Verify ingredients tab shows flat grid only, no toggle visible

---

### Phase 5: Top Section Cleanup (FR-4)

**Goal**: Verify/complete dashboard compaction

1. **Verify current state**:
   - F042 already compacted dashboards to 1-2 lines
   - Check if header is truly minimal (40px)
   - Verify counts display correctly (not stuck at 0)

2. **If still wasting space**:
   - Option A: Remove dashboard header entirely (set_dashboard not called)
   - Option B: Reduce header height further

3. **Expected outcome**:
   - F042 may have already resolved this
   - Document finding in implementation notes

**Testing**: Measure grid rows visible, verify no broken counts

---

## Complexity Tracking

*No constitution violations identified.*

| Consideration | Resolution |
|---------------|------------|
| Group tabs add nesting | Matches existing Materials pattern - acceptable |
| Finished Goods filtering | TBD - research bundle flag in model |
| Tree view removal | F052 Hierarchy Admin replaces this function |

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Mode reorder breaks shortcuts | Test all Ctrl+1-6 shortcuts |
| Tab restructure breaks navigation | Preserve tab widget instances, only change containers |
| Tree removal loses functionality | F052 Hierarchy Admin provides alternative |
| Finished Goods filter unclear | Research model before implementing |

---

## Testing Strategy

### Manual UI Testing

1. **Mode Navigation**:
   - [ ] Modes appear in order: Observe, Catalog, Plan, Purchase, Make, Deliver
   - [ ] Ctrl+1 through Ctrl+6 activate correct modes
   - [ ] Deliver mode shows placeholder
   - [ ] Mode switching preserves tab state

2. **Catalog Menu**:
   - [ ] 4 groups visible: Ingredients, Materials, Recipes, Packaging
   - [ ] Each group has correct sub-tabs
   - [ ] All existing tabs accessible
   - [ ] Data displays correctly in each tab

3. **Purchase Menu**:
   - [ ] Tabs in order: Inventory, Purchases, Shopping Lists
   - [ ] All tabs functional

4. **UI Cleanup**:
   - [ ] No tree toggle in Ingredients tab
   - [ ] Grid shows 3-5 more rows than before
   - [ ] No broken "0 count" displays

### Automated Tests

- Existing test suite should pass (no service changes)
- Run `./run-tests.sh -v` after implementation

---

## Dependencies

- F052 (Hierarchy Admin) - COMPLETE - provides alternative to tree view
- Materials submenu implementation (F047/F048) - COMPLETE - pattern to copy

---

## Notes for Implementation

1. **Work incrementally**: Mode reorder first (least risky), then Purchase tabs, then Catalog restructure
2. **Preserve existing widgets**: Don't recreate IngredientsTab, ProductsTab, etc. - embed in new containers
3. **Copy Materials pattern**: Use materials_tab.py as template for group wrappers
4. **Test between phases**: Verify app runs after each major change
5. **Document Finished Goods filter**: Need to verify how bundle vs food-only is determined

---

**STOP POINT**: Plan complete. Run `/spec-kitty.tasks` to generate work packages.
