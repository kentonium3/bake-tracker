# Implementation Plan: Recipe UI Polish - Yield Information and Variant Grouping

**Branch**: `067-recipe-ui-polish-yield-variants` | **Date**: 2026-01-25 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `kitty-specs/067-recipe-ui-polish-yield-variants/spec.md`

## Summary

Polish the recipe management UI to improve clarity and usability:
1. Add column labels to Edit Recipe yield section
2. Implement visual variant grouping in Recipe Catalog and Finished Units grids
3. Clean up Create Variant dialog layout and terminology
4. Default Production Ready to True for new recipes

All changes are UI-layer only - no service, model, or schema modifications required.

## Technical Context

**Language/Version**: Python 3.10+
**Primary Dependencies**: CustomTkinter (UI framework)
**Storage**: N/A (no schema changes)
**Testing**: pytest (existing patterns), manual UI verification
**Target Platform**: Desktop (Windows/macOS)
**Project Type**: Single desktop application
**Performance Goals**: N/A (no performance-critical changes)
**Constraints**: Must follow existing CustomTkinter layout patterns
**Scale/Scope**: 4 UI components modified

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. User-Centric Design | PASS | Improves clarity for non-technical user |
| II. Data Integrity | PASS | No data changes, display only |
| III. Future-Proof Schema | PASS | No schema changes |
| IV. Test-Driven Development | PASS | UI changes with manual verification |
| V. Layered Architecture | PASS | All changes in UI layer only |
| VI. Schema Change Strategy | PASS | N/A - no schema changes |
| VII. Pragmatic Aspiration | PASS | Simple improvements, no over-engineering |

**Desktop Phase Checks**:
- Does this design block web deployment? **NO** - UI patterns translate to web
- Is the service layer UI-independent? **YES** - No service changes
- What's the web migration cost? **NONE** - These are UI-layer polish items

## Project Structure

### Documentation (this feature)

```
kitty-specs/067-recipe-ui-polish-yield-variants/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Phase 0 research findings
├── checklists/
│   └── requirements.md  # Spec validation checklist
└── tasks/               # Work packages (generated by /spec-kitty.tasks)
```

### Source Code (files to modify)

```
src/ui/
├── widgets/
│   └── data_table.py         # RecipeDataTable, FinishedGoodDataTable
├── forms/
│   ├── recipe_form.py        # Yield section labels, spacing, defaults
│   └── variant_creation_dialog.py  # Section title, layout cleanup
└── recipes_tab.py            # May need sorting logic adjustment
```

**Structure Decision**: Existing single-project structure maintained. All changes within `src/ui/`.

## Research Findings

See [research.md](research.md) for detailed investigation.

**Key Decisions**:

1. **Grid Hierarchy**: Implement visual grouping in existing DataTable (no CTkTreeview migration)
   - Sort variants after their base recipe
   - Add "↳ " prefix to variant names
   - Lower complexity, maintains existing patterns

2. **Layout Patterns**: Follow CustomTkinter best practices
   - May improve on existing dialog patterns where beneficial
   - Consistency with modern UI conventions prioritized

3. **Scope Boundary**: UI-layer only
   - No service changes needed
   - No model changes needed
   - Existing `base_recipe_id` relationship provides all data needed

## Implementation Strategy

### Phase 1: Edit Recipe Dialog Polish (US1, US4)

**Components**: `src/ui/forms/recipe_form.py`

1. Add column labels above yield inputs:
   - Row of labels: "Finished Unit Name" | "Unit" | "Qty/Batch"
   - Align with existing YieldTypeRow columns

2. Update help text:
   - From: "Yield Types* - Each row defines a finished product..."
   - To: "Each row defines a Finished Unit and quantity per batch for this recipe."

3. Reduce vertical spacing after section title

4. Default `production_ready=True` for new recipes

### Phase 2: Recipe Catalog Variant Grouping (US2)

**Components**: `src/ui/widgets/data_table.py` (RecipeDataTable)

1. Modify data loading/sorting:
   - Query returns all recipes
   - Sort: base recipes alphabetically, variants grouped under base

2. Modify `_get_row_values()`:
   - Detect variant via `base_recipe_id`
   - Prepend "↳ " to variant names

### Phase 3: Create Variant Dialog Polish (US3)

**Components**: `src/ui/forms/variant_creation_dialog.py`

1. Change section header:
   - From: "Variant Yields:"
   - To: "Finished Unit Name(s):"

2. Remove "Base:" label prefix from FU rows

3. Left-justify input fields

4. Adjust variant name section layout:
   - Label above field (not inline)
   - Help text between label and input

### Phase 4: Finished Units Grid Grouping (US5)

**Components**: `src/ui/widgets/data_table.py` (FinishedGoodDataTable)

1. Modify data retrieval to include recipe relationship info

2. Sort finished units:
   - Group by recipe
   - Base recipe FUs first, variant FUs indented

3. Add "↳ " indicator for variant-sourced FUs

## Complexity Tracking

*No constitution violations - all changes are simple UI polish.*

## Work Package Decomposition (Preview)

Suggested WP breakdown for `/spec-kitty.tasks`:

| WP | Scope | Priority | Dependencies |
|----|-------|----------|--------------|
| WP01 | Edit Recipe yield labels + spacing | P1 | None |
| WP02 | Production Ready default | P2 | None |
| WP03 | Recipe Catalog variant grouping | P1 | None |
| WP04 | Create Variant dialog polish | P2 | None |
| WP05 | Finished Units grid grouping | P3 | WP03 (pattern reuse) |

**Parallelization**: WP01, WP02, WP03, WP04 can run in parallel. WP05 depends on WP03 for pattern.

---

## Planning Complete

**Artifacts Generated**:
- `plan.md` (this file)
- `research.md` (grid investigation findings)

**Artifacts Skipped** (not applicable):
- `data-model.md` - No schema changes
- `contracts/` - No API changes
- `quickstart.md` - No new setup required

**Next Step**: Run `/spec-kitty.tasks` to generate work packages.
