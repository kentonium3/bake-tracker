# Work Packages: Configuration Management Enhancement

**Inputs**: Design documents from `/kitty-specs/090-configuration-management-enhancement/`
**Prerequisites**: plan.md (required), spec.md (user stories)

**Tests**: Unit tests for new Config properties included in WP02.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package is independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/` generated by `/spec-kitty.tasks`.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Include precise file paths or modules.

---

## Work Package WP01: Config Class Extension (Priority: P0)

**Goal**: Extend the existing Config class with all new configuration properties for database settings, PostgreSQL support, feature flags, UI configuration, and health check settings.
**Independent Test**: All new Config properties return correct default values; environment variable overrides work.
**Prompt**: `/tasks/WP01-config-class-extension.md`
**Estimated Size**: ~400 lines

### Included Subtasks
- [x] T001 Add database connection properties (db_timeout, db_pool_size, db_pool_recycle) to `src/utils/config.py`
- [x] T002 Add database_type property and update database_url for PostgreSQL support in `src/utils/config.py`
- [x] T003 Add db_connect_args computed property in `src/utils/config.py`
- [x] T004 Add feature_flags dictionary property in `src/utils/config.py`
- [x] T005 Add UI configuration properties (ui_theme, ui_appearance) with validation in `src/utils/config.py`
- [ ] T006 Add health_check_interval property in `src/utils/config.py`
- [ ] T007 Add comprehensive docstrings for all new Config properties

### Implementation Notes
- Follow existing `@property` pattern with `os.environ.get()` for defaults
- Use type conversion for integer properties (db_timeout, db_pool_size, etc.)
- Use string comparison for boolean feature flags ("true"/"false")
- Validate UI theme/appearance against allowed values, use defaults if invalid
- Add logging import for warning on invalid values

### Parallel Opportunities
- None within this WP (all changes to single file)

### Dependencies
- None (starting package)

### Risks & Mitigations
- Risk: Breaking existing database_url behavior
  - Mitigation: Only change when database_type is "postgresql"
- Risk: Invalid environment values causing crashes
  - Mitigation: Graceful fallback to defaults with warning

---

## Work Package WP02: Consumer Updates & Tests (Priority: P1)

**Goal**: Update all consumer files to use Config for their settings, and add unit tests for the new properties.
**Independent Test**: Application starts correctly with no env vars; tests pass verifying all Config property behaviors.
**Prompt**: `/tasks/WP02-consumer-updates-tests.md`
**Estimated Size**: ~300 lines

### Included Subtasks
- [ ] T008 [P] Update `src/services/database.py` to use Config.db_connect_args
- [ ] T009 [P] Update `src/main.py` to use Config.ui_theme and ui_appearance
- [ ] T010 [P] Update `src/services/health_service.py` to use Config.health_check_interval
- [ ] T011 Add unit tests for new Config properties in `src/tests/unit/test_config.py`

### Implementation Notes
- T008: Replace hard-coded `{"check_same_thread": False, "timeout": 30}` with `config.db_connect_args`
- T009: Replace hard-coded "system" and "blue" with Config properties
- T010: Use `config.health_check_interval` as default when `check_interval` not passed to constructor
- T011: Test each property's default, env var override, and invalid value handling

### Parallel Opportunities
- T008, T009, T010 can all proceed in parallel (different files)

### Dependencies
- Depends on WP01 (requires Config properties to exist)

### Risks & Mitigations
- Risk: Breaking application startup
  - Mitigation: Maintain identical default values to current hard-coded values
- Risk: Test environment pollution from env vars
  - Mitigation: Use monkeypatch to isolate env var tests

---

## Dependency & Execution Summary

- **Sequence**: WP01 â†’ WP02
- **Parallelization**: WP02 subtasks (T008-T010) can run in parallel after WP01 complete
- **MVP Scope**: Both WPs required; WP01 enables WP02

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Add database connection properties | WP01 | P0 | No |
| T002 | Add database_type and update database_url | WP01 | P0 | No |
| T003 | Add db_connect_args computed property | WP01 | P0 | No |
| T004 | Add feature_flags dictionary property | WP01 | P0 | No |
| T005 | Add UI configuration properties | WP01 | P0 | No |
| T006 | Add health_check_interval property | WP01 | P0 | No |
| T007 | Add docstrings for new properties | WP01 | P0 | No |
| T008 | Update database.py to use Config | WP02 | P1 | Yes |
| T009 | Update main.py to use Config | WP02 | P1 | Yes |
| T010 | Update health_service.py to use Config | WP02 | P1 | Yes |
| T011 | Add unit tests for Config properties | WP02 | P1 | No |
