# Work Packages: Event Production Dashboard

**Inputs**: Design documents from `kitty-specs/018-event-production-dashboard/`
**Prerequisites**: plan.md (required), spec.md (user stories), research.md, data-model.md, quickstart.md

**Tests**: Minimal - only service layer tests for new method.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package must be independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `tasks/planned/` generated by `/spec-kitty.tasks`.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Include precise file paths or modules.

---

## Work Package WP01: Service Layer Foundation (Priority: P0)

**Goal**: Add batch event progress method and color constants to enable UI development.
**Independent Test**: `get_events_with_progress()` returns correct data for multiple events with various filter options.
**Prompt**: `tasks/planned/WP01-service-layer-foundation.md`

### Included Subtasks
- [x] T001 Add STATUS_COLORS dict to `src/utils/constants.py`
- [x] T002 Implement `get_events_with_progress()` in `src/services/event_service.py`
- [x] T003 Add tests for `get_events_with_progress()` in `src/tests/test_event_service.py`

### Implementation Notes
1. Add color constants first (T001) - enables UI work to start
2. Implement service method (T002) - calls existing progress methods for each event
3. Add tests (T003) - verify filter logic and data structure

### Parallel Opportunities
- T001 can be done independently, but T002 and T003 should be sequential (write method, then tests)

### Dependencies
- None (starting package)

### Risks & Mitigations
- Performance with many events → batch queries, not N+1; method already uses existing optimized progress methods

---

## Work Package WP02: EventCard Widget (Priority: P1) - MVP

**Goal**: Create reusable EventCard widget with collapsed/expanded views, color-coded progress bars, and quick action buttons.
**Independent Test**: Widget renders correctly with sample event data; expand/collapse toggles work; colors match status.
**Prompt**: `tasks/planned/WP02-event-card-widget.md`

### Included Subtasks
- [x] T004 [P] Create EventCard class skeleton in `src/ui/widgets/event_card.py`
- [x] T005 Implement collapsed view (header row with event name, date, overall progress bar, fulfillment counts)
- [x] T006 Implement expanded view (individual production/assembly target progress bars)
- [x] T007 Implement `toggle_expanded()` using pack_forget/pack pattern
- [x] T008 [P] Implement color-coded progress bars using STATUS_COLORS
- [x] T009 Implement quick action button row with callbacks

### Implementation Notes
1. Create class skeleton with `__init__` accepting `event_data` dict and `callbacks` dict (T004)
2. Build collapsed view showing summary info (T005)
3. Build expanded detail view with target-level progress (T006)
4. Wire toggle behavior - detail frame hidden by default, shown on click (T007)
5. Apply color coding based on progress_pct: 0% gray, 1-99% amber, 100% green, >100% teal (T008)
6. Add quick action buttons: Record Production, Record Assembly, Shopping List, Event Detail (T009)

### Parallel Opportunities
- T004 (skeleton) and T008 (colors) can start in parallel with WP01
- T005, T006, T007, T009 are sequential within the widget

### Dependencies
- Depends on WP01 (STATUS_COLORS and get_events_with_progress output structure)

### Risks & Mitigations
- CustomTkinter styling limitations → use standard CTkFrame with border_width for card appearance
- Progress bar color changes → use `configure(progress_color=...)` method

---

## Work Package WP03: Dashboard Tab Enhancement (Priority: P1) - MVP

**Goal**: Transform ProductionDashboardTab from single-event selector to multi-event status board with filters.
**Independent Test**: Dashboard shows multiple event cards; filter dropdown changes visible events; quick actions work.
**Prompt**: `tasks/planned/WP03-dashboard-tab-enhancement.md`

### Included Subtasks
- [x] T010 Add filter controls frame (dropdown for Active/Future, Past, All + date pickers)
- [x] T011 Create scrollable CTkScrollableFrame container for EventCard widgets
- [x] T012 Implement `_rebuild_event_cards()` method to fetch and display events
- [x] T013 Wire filter change handlers to rebuild cards
- [x] T014 Wire quick action callbacks to existing dialogs (RecordProductionDialog, RecordAssemblyDialog)
- [x] T015 Handle edge cases: no events, no targets, empty filter results
- [x] T016 Add "Create Event" button to dashboard header

### Implementation Notes
1. Replace existing `_create_event_progress_section()` with new filter controls (T010)
2. Create scrollable container below filters (T011)
3. Implement card rebuild logic calling `get_events_with_progress()` (T012)
4. Connect filter dropdown `command=` to trigger rebuild (T013)
5. Pass callback functions to EventCard for quick actions (T014)
6. Show appropriate empty states with helpful messages (T015)
7. Add Create Event button that opens new event dialog (T016)

### Parallel Opportunities
- T010 (filters) and T011 (container) can be developed in parallel
- T015 (edge cases) and T016 (Create Event) can be done in parallel

### Dependencies
- Depends on WP01 (service method)
- Depends on WP02 (EventCard widget)

### Risks & Mitigations
- Date picker complexity → use CTkEntry with date format validation (YYYY-MM-DD) as simple solution
- Large event count → CTkScrollableFrame handles scrolling; add pagination note for 20+ events

---

## Work Package WP04: Integration & Validation (Priority: P2)

**Goal**: Verify complete feature integration, tab ordering, and edge case handling.
**Independent Test**: App launches with Production Dashboard as default; all acceptance scenarios pass.
**Prompt**: `tasks/planned/WP04-integration-validation.md`

### Included Subtasks
- [x] T017 Verify Production Dashboard is first/default tab on app launch
- [x] T018 Test all 4 status indicator states (Not Started, In Progress, Complete, Exceeded)
- [x] T019 Test filter behavior (default Active & Future, Past, All, date range)
- [x] T020 Test quick action integration (Record Production, Record Assembly, Shopping List, Event Detail)
- [x] T021 Validate performance (dashboard loads within 2 seconds for typical usage)
- [x] T022 Run full regression on existing functionality

### Implementation Notes
1. Launch app and verify tab selection (T017)
2. Create test events with 0%, 50%, 100%, 125% progress and verify colors/labels (T018)
3. Create past/future events and verify filter behavior (T019)
4. Click each quick action and verify correct dialog opens with event pre-selected (T020)
5. Load with 10+ events and measure load time (T021)
6. Run existing test suite to catch regressions (T022)

### Parallel Opportunities
- T017-T021 are independent manual validation tasks
- T022 runs independently via pytest

### Dependencies
- Depends on WP01, WP02, WP03 (all prior packages)

### Risks & Mitigations
- Regression risk → run full test suite before marking complete
- Performance issue → optimize get_events_with_progress() if needed

---

## Dependency & Execution Summary

```
WP01 (Service Layer) ─────────────────────────────────────┐
                                                           │
WP02 (EventCard Widget) ──────────────────────────────────┼──→ WP04 (Integration)
        │                                                  │
        └──→ WP03 (Dashboard Tab Enhancement) ────────────┘
```

- **Sequence**: WP01 → WP02 → WP03 → WP04
- **Parallelization**: WP01 and WP02 can start in parallel (widget skeleton uses mocked data)
- **MVP Scope**: WP01 + WP02 + WP03 deliver core functionality

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Add STATUS_COLORS to constants.py | WP01 | P0 | Yes |
| T002 | Implement get_events_with_progress() | WP01 | P0 | No |
| T003 | Add tests for get_events_with_progress() | WP01 | P0 | No |
| T004 | Create EventCard class skeleton | WP02 | P1 | Yes |
| T005 | Implement collapsed view | WP02 | P1 | No |
| T006 | Implement expanded view | WP02 | P1 | No |
| T007 | Implement toggle_expanded() | WP02 | P1 | No |
| T008 | Implement color-coded progress bars | WP02 | P1 | Yes |
| T009 | Implement quick action buttons | WP02 | P1 | No |
| T010 | Add filter controls frame | WP03 | P1 | Yes |
| T011 | Create scrollable EventCard container | WP03 | P1 | Yes |
| T012 | Implement _rebuild_event_cards() | WP03 | P1 | No |
| T013 | Wire filter change handlers | WP03 | P1 | No |
| T014 | Wire quick action callbacks | WP03 | P1 | No |
| T015 | Handle edge cases | WP03 | P1 | Yes |
| T016 | Add Create Event button | WP03 | P1 | Yes |
| T017 | Verify default tab on launch | WP04 | P2 | Yes |
| T018 | Test status indicator states | WP04 | P2 | Yes |
| T019 | Test filter behavior | WP04 | P2 | Yes |
| T020 | Test quick action integration | WP04 | P2 | Yes |
| T021 | Validate performance | WP04 | P2 | Yes |
| T022 | Run full regression | WP04 | P2 | Yes |
