# Work Packages: Ingredient Hierarchy Comprehensive Testing

**Inputs**: Design documents from `/kitty-specs/036-ingredient-hierarchy-comprehensive/`
**Prerequisites**: plan.md (required), spec.md (user stories), research.md (test coverage analysis)

**Tests**: This feature IS testing - all work packages focus on verification and documentation.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package must be independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/planned/` generated by `/spec-kitty.tasks`.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Include precise file paths or modules.

---

## Work Package WP01: Run Automated Test Suite (Priority: P1) MVP

**Goal**: Execute all ingredient hierarchy automated tests and verify 100% pass rate.
**Independent Test**: Run `PYTHONPATH=. pytest src/tests -v -k ingredient --tb=short` and confirm zero failures.
**Prompt**: `tasks/planned/WP01-run-automated-tests.md`

### Included Subtasks
- [ ] T001 Run ingredient hierarchy service tests (`src/tests/services/test_ingredient_hierarchy_service.py`)
- [ ] T002 Run ingredient service tests including deletion protection (`src/tests/services/test_ingredient_service.py`)
- [ ] T003 [P] Run recipe leaf-only validation tests (`src/tests/services/test_recipe_service.py -k leaf`)
- [ ] T004 [P] Run product catalog leaf-only tests (`src/tests/services/test_product_catalog_service.py -k leaf`)
- [ ] T005 Generate coverage report for ingredient services
- [ ] T006 Document test results in `research.md`

### Implementation Notes
1. Activate venv: `source venv/bin/activate`
2. Run tests with coverage: `PYTHONPATH=. pytest src/tests -v --cov=src/services --cov-report=html`
3. Filter ingredient tests: `PYTHONPATH=. pytest src/tests -v -k ingredient --tb=short`
4. Capture pass/fail counts and coverage percentage

### Parallel Opportunities
- T003 and T004 can run in parallel with T001/T002 if using separate terminal sessions

### Dependencies
- None (first package)

### Risks & Mitigations
- Test environment issues: Verify venv has all dependencies (`pip install -r requirements.txt`)
- Database state: Tests should use fixtures, but verify no state pollution

---

## Work Package WP02: Manual UI Validation - Cascading Selectors (Priority: P1)

**Goal**: Manually verify cascading selector behavior in all 4 UI locations.
**Independent Test**: Start app with `python src/main.py` and test each location per checklist.
**Prompt**: `tasks/planned/WP02-manual-ui-validation.md`

### Included Subtasks
- [ ] T007 Test Product edit form cascading selector (L0 -> L1 -> L2)
- [ ] T008 Test Recipe creation form cascading selector
- [ ] T009 Test Product tab filter cascading behavior
- [ ] T010 Test Inventory tab filter cascading behavior
- [ ] T011 Test Clear/Reset functionality in all filters
- [ ] T012 Document UI test results with pass/fail status

### Implementation Notes
1. Start app: `python src/main.py`
2. For each location, test:
   - Select L0 category -> verify L1 options update
   - Select L1 subcategory -> verify L2 options update
   - Change L0 -> verify L1/L2 reset
   - Clear filter -> verify all reset
3. Note any unexpected behavior or UI issues

### Parallel Opportunities
- None - requires sequential app interaction

### Dependencies
- Depends on WP01 (tests should pass before UI validation)

### Risks & Mitigations
- App crash: Capture error messages and stack traces
- Inconsistent behavior: Test multiple times with different data

---

## Work Package WP03: Deletion Protection Validation (Priority: P1)

**Goal**: Verify deletion protection blocks correctly in all scenarios with proper error messages.
**Independent Test**: Attempt to delete ingredients with various references and confirm blocking.
**Prompt**: `tasks/planned/WP03-deletion-protection-validation.md`

### Included Subtasks
- [ ] T013 Test deletion blocked when Products reference ingredient
- [ ] T014 Test deletion blocked when Recipes reference ingredient
- [ ] T015 Test deletion blocked when Children exist
- [ ] T016 Test deletion allowed when no references (verify cascade delete aliases/crosswalks)
- [ ] T017 Verify error messages include correct counts
- [ ] T018 Document deletion test results

### Implementation Notes
1. In app, navigate to Ingredients tab
2. For each test case:
   - Identify an ingredient meeting the criteria
   - Attempt to delete
   - Verify blocking with expected message or success
3. Document exact error messages shown

### Parallel Opportunities
- T013-T16 can be tested in sequence during same app session

### Dependencies
- Depends on WP01 (tests should pass first)

### Risks & Mitigations
- Test data missing: Ensure sample_data.json has ingredients with products/recipes/children

---

## Work Package WP04: Final Documentation & Gap Update (Priority: P2)

**Goal**: Update all documentation to reflect Phase 4 completion and close out ingredient hierarchy implementation.
**Independent Test**: All documentation reflects current state and no gaps remain.
**Prompt**: `tasks/planned/WP04-final-documentation.md`

### Included Subtasks
- [ ] T019 Update `docs/design/_F033-F036_ingredient_hierarchy_gap_analysis.md` - mark Phase 4 complete
- [ ] T020 Update `docs/requirements/req_ingredients.md` acceptance checklist
- [ ] T021 Create test results summary in `research.md`
- [ ] T022 Verify all success criteria from spec.md are met
- [ ] T023 Update feature_roadmap.md if needed

### Implementation Notes
1. Update gap analysis: Change Phase 4 from PENDING to COMPLETE
2. Update completion percentage to 100%
3. Mark all acceptance checklist items as checked
4. Summarize test results (pass rate, coverage %)

### Parallel Opportunities
- T019-T21 can be done in parallel if different files

### Dependencies
- Depends on WP01, WP02, WP03 (all testing complete)

### Risks & Mitigations
- Incomplete testing: Ensure all WP01-03 are done before this package

---

## Dependency & Execution Summary

- **Sequence**: WP01 -> WP02 -> WP03 -> WP04
- **Parallelization**: WP02 and WP03 can run in parallel after WP01 completes
- **MVP Scope**: WP01 (automated tests passing) is the minimum viable verification

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Run hierarchy service tests | WP01 | P1 | No |
| T002 | Run ingredient service tests | WP01 | P1 | No |
| T003 | Run recipe leaf-only tests | WP01 | P1 | Yes |
| T004 | Run product catalog leaf tests | WP01 | P1 | Yes |
| T005 | Generate coverage report | WP01 | P1 | No |
| T006 | Document test results | WP01 | P1 | No |
| T007 | Test Product edit form cascade | WP02 | P1 | No |
| T008 | Test Recipe form cascade | WP02 | P1 | No |
| T009 | Test Product tab filter | WP02 | P1 | No |
| T010 | Test Inventory tab filter | WP02 | P1 | No |
| T011 | Test Clear/Reset functionality | WP02 | P1 | No |
| T012 | Document UI test results | WP02 | P1 | No |
| T013 | Test deletion blocked (Products) | WP03 | P1 | No |
| T014 | Test deletion blocked (Recipes) | WP03 | P1 | No |
| T015 | Test deletion blocked (Children) | WP03 | P1 | No |
| T016 | Test deletion allowed (no refs) | WP03 | P1 | No |
| T017 | Verify error message counts | WP03 | P1 | No |
| T018 | Document deletion test results | WP03 | P1 | No |
| T019 | Update gap analysis document | WP04 | P2 | Yes |
| T020 | Update requirements checklist | WP04 | P2 | Yes |
| T021 | Create test results summary | WP04 | P2 | Yes |
| T022 | Verify success criteria met | WP04 | P2 | No |
| T023 | Update feature roadmap | WP04 | P2 | No |

---

> Total: 4 work packages, 23 subtasks
